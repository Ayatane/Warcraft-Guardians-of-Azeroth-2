namespace = scourgequel

## Events for the Scourge and the preceeding invasion of Quel'thalas


## scourgequel.0001 - Notification to all rulers that Lordaeron has fallen
## scourgequel.0002 - Notification to Lich King that he requires a powerful spellcaster to complete the Burning Legion spell
## scourgequel.0003 - [ALT] Lich King notification - doesn't have to listen to jailors because they are le dead

## scourgequel.0004 - Notification to all rulers that Quel'thalas has fallen and the Sunwell has been corrupted by undead
## scourgequel.0005 - Notification to all rulers that Suramar has fallen and the Nightwell has been corrupted by undead

## scourgequel.0006 - Notification to High Elves to find a new source of crack or become crack elves (Wretched)
## scourgequel.0007 - Notification to Nightborne to find a new source of crack or become crack elves (Withered)

## scourgequel.0008 - Kel'thuzad Reborn Event
## scourgequel.0009 - LK notification - move to next phase of the plan (Dalaran)



### Notification to all rulers that Lordaeron has fallen
scourgequel.0001 = {
	type = character_event
	#window = fullscreen_event
	title = SCQUEL.0001_TITLE
	desc = SCQUEL.0001_DESC
	theme = plague
	left_portrait = {
		character = scope:invaderquelthalas
		animation = personality_zealous
	}

	hidden_effect = {
	title:e_scourge.holder = { save_scope_as = scoped_lichking }
	title:k_lordaeron.holder = { save_scope_as = scoped_lordaeronking }
	title:k_quelthalas.holder = { save_scope_as = scoped_quelthalasking }
	}

	option = {
		name = SCQUEL.0001_OPT_A
		scope:invaderquelthalas = { 
			trigger_event = { 
				id = scourgequel.0002
				days = 3 
			}
		}
		every_ruler = {
			limit = {
				NOT = {
					this = root
				}
				any_held_title = {
					trigger_if = {
						limit = {
							tier = tier_county
						}
						title_province = {
							OR = {
								geographical_region = world_eastern_kingdoms_azeroth
								geographical_region = world_eastern_kingdoms_lordaeron
								geographical_region = world_eastern_kingdoms_khaz_modan
								geographical_region = world_eastern_kingdoms_quelthalas
							}
						}
					}
					trigger_else = {
						title_capital_county.title_province = {
							OR = {
								geographical_region = world_eastern_kingdoms_azeroth
								geographical_region = world_eastern_kingdoms_lordaeron
								geographical_region = world_eastern_kingdoms_khaz_modan
								geographical_region = world_eastern_kingdoms_quelthalas
							}
						}
					}
				}
			}
			trigger_event = { 
				id = scourgequel.0008
				days = 7
			}
		}
	}
}

## Opportunity to identify betrayers within Quel'thalas
scourgequel.0002 = { 
	type = character_event
	title = SCQUEL.0002_TITLE
	desc = SCQUEL.0002_DESC
	theme = plague
	left_portrait = {
		character = scope:invaderquelthalas
		animation = personality_bold
	}
	option = { ##Sends out notification to vassals of Quel'thalas, become undead and swear fealty
		name = SCQUEL.0002_OPT_A
		hidden_effect = {
			every_ruler = {
				limit = {
					is_landed = yes
					is_vassal_of = title:k_quelthalas.holder
					highest_held_title_tier >= tier_duchy
					highest_held_title_tier <= tier_kingdom
					NOR = {
						is_at_war_with = scope:invaderquelthalas
						this = scope:invaderquelthalas
					}
				}
				trigger_event = {
					id = scourgequel.0003
					days = { 3 5 }
				}
			}
			scope:invaderquelthalas = { 
				trigger_event = { 
					id = scourgequel.0006
					days = 14 
				}
			}
		}
	}
	option = { ##Declares war
		name = SCQUEL.0002_OPT_B
		start_war = {
			casus_belli = scourge_quelthalas_cb
			target = title:k_quelthalas.holder
			target_title = title:k_quelthalas
		}
	}
}

scourgequel.0003 = {
	type = letter_event
	opening = SCQUEL.0003_TITLE
	desc = SCQUEL.0003_DESC
	sender = {
		character = scope:invaderquelthalas
		animation = personality_bold
	}

	trigger = {
		NOT = { is_at_war_with = scope:invaderquelthalas }
		NOT = { root = scope:invaderquelthalas }
	}

	immediate = {
		save_scope_as = demand_recipient
	}

	option = { # Submit
		name = SCQUEL.0003_OPT_A
		custom_tooltip = SCQUEL.0003_OPT_A_TT
		scope:invaderquelthalas = {
			add_opinion = {
				modifier = became_vassal
				target = scope:demand_recipient
				opinion = -10
			}
		}
		hidden_effect = {
			scope:invaderquelthalas = {
				trigger_event = scourgequel.0004 ##Acceptance event
			}
		}
		ai_chance = {
			base = 10
			modifier = { ## (Looking at you Dar'Khan the Betrayer)
				factor = 5
				has_trait = greedy
			}
			modifier = {
				factor = 5
				has_trait = arrogant
			}
			modifier = {
				factor = 5
				has_trait = ambitious
			}
			modifier = {
				factor = 5
				has_trait = deceitful
			}
			modifier = { ##If they manage to become undead somehow
				factor = 1000
				has_trait = being_undead
			}
			# We want some of the elves to survive
			modifier = {
				factor = 0.1
				realm_size >= 10
			}
			}
		}
	option = { # I'd rather die
		name = SCQUEL.0003_OPT_B
		custom_tooltip = SCQUEL.0003_OPT_B_TT
		scope:invaderquelthalas = {
			add_opinion = {
				modifier = insult_opinion
				target = scope:demand_recipient
				opinion = -100
			}
		}
		add_internal_flag = dangerous
		hidden_effect = {
			scope:invaderquelthalas = {
				trigger_event = scourgequel.0005 ##Denial
			}
		}
		ai_chance = {
			base = 100
		}
		stress_impact = {
			base = medium_stress_gain
		}
	}
}

scourgequel.0004 = {
	type = letter_event
	opening = SCQUEL.0004_TITLE
	desc = SCQUEL.0004_DESC
	sender = scope:demand_recipient

	immediate = {
		create_title_and_vassal_change = {
			type = swear_fealty
			save_scope_as = title_change
			add_claim_on_loss = no
		}
		scope:demand_recipient = {
			raise_undead_by_vassal_effect = { MASTER = root CHANGE = scope:title_change FROSTMOURNE = yes }
		}
		resolve_title_and_vassal_change = scope:title_change

		

		debug_log = "Someone accepted Quelthalas Invader subjugation"
		debug_log_scopes = yes
	}

	option = { # You get to live (Kind of)
		name = SCQUEL.0004_OPT_A
	}
}

# Subjugation refused
scourgequel.0005 = {
	type = letter_event
	opening = SCQUEL.0005_TITLE
	desc = SCQUEL.0005_DESC
	sender = {
		character = scope:demand_recipient
		animation = personality_bold
	}

	immediate = {
		hidden_effect = {
			scope:demand_recipient.primary_title = {
				save_scope_as = target_title
			}
		}

		debug_log = "Someone refused Scourge subjugation during Queltha'las"
		debug_log_scopes = yes
	}

	option = { # FOOLS!
		name = SCQUEL.0005_OPT_A
	}
}

scourgequel.0006 = {
	type = character_event
	title = SCQUEL.0006_TITLE
	desc = SCQUEL.0006_DESC
	theme = plague
	left_portrait = {
		character = scope:invaderquelthalas
		animation = war_attacker
	}
	right_portrait = {
		character = title:k_quelthalas.holder
		animation = war_defender
	}
	option = { # time 2 die punk
		name = SCQUEL.0006_OPT_A
		start_war = {
			casus_belli = scourge_quelthalas_cb
			target = title:k_quelthalas.holder
			target_title = title:k_quelthalas
		}
		spawn_army = {
			uses_supply = no
			inheritable = no
			name = raised_scourge_quelthalas_army
			levies = 2000
			men_at_arms = {
				type = ghoul
				stacks = 20
			}
			men_at_arms = {
				type = abomination
				stacks = 16
			}
			men_at_arms = {
				type = banshee
				stacks = 8
			}
			men_at_arms = {
				type = trebuchet
				stacks = 3
			}
			men_at_arms = {
				type = archers
				stacks = 5
			}
			location = capital_province
		}
	}
}

scourgequel.0007 = { ##notifcation for quelthalas ruler that they're about to get stomped
	type = character_event
	#window = fullscreen_event
	title = SCQUEL.0007_TITLE
	desc = SCQUEL.0007_DESC
	theme = plague
	left_portrait = {
		character = scope:invaderquelthalas
		animation = war_attacker
	}
	right_portrait = {
		character = title:k_quelthalas.holder
		animation = war_defender
	}
	option = { # acknowledgement
		name = SCQUEL.0007_OPT_A
	}
}

scourgequel.0008 = { ##notifcation for wider region that lordaeron is dead, quelthalas is next
	type = character_event
	#window = fullscreen_event
	title = SCQUEL.0008_TITLE
	desc = SCQUEL.0008_DESC
	theme = plague
	left_portrait = {
		character = scope:invaderquelthalas
		animation = personality_zealous
	}
	right_portrait = {
		character = title:k_quelthalas.holder
		animation = war_defender
	}
	option = { # acknowledgement
		name = SCQUEL.0008_OPT_A
	}
}

scourgequel.0009 = { ##test
	type = character_event
	#window = fullscreen_event
	title = SCQUEL.0009_TITLE
	desc = SCQUEL.0009_DESC
	theme = plague
	left_portrait = {
		character = scope:attacker
		animation = aggressive_sword
	}
	right_portrait = {
		character = character:42076
		animation = fear
	}
	option = { # acknowledgement
		name = SCQUEL.0009_OPT_A
	}
}

scourgequel.0010 = { ##test
	type = character_event
	#window = fullscreen_event
	title = SCQUEL.0010_TITLE
	desc = SCQUEL.0010_DESC
	theme = plague
	left_portrait = {
		character = scope:attacker
		animation = aggressive_sword
	}
	right_portrait = {
		character = character:42076
		animation = fear
	}
	option = { # acknowledgement
		name = SCQUEL.0010_OPT_A
		character:42076 = {
			raise_undead_by_basic_effect = { MASTER = scope:attacker FROSTMOURNE = yes }
			}
	}
}