namespace = wc_scourge_plague

wc_scourge_plague.1000 = { #Scourge plague story cycle pacing control
	hidden = yes

	immediate = {
		if = {
			limit = {
				any_neighboring_top_liege_realm_owner = {
					has_character_flag = scourge_plague_splash
				}
			}
			if = {
				limit = {
					has_character_flag = scourge_plague_closer
				}
				remove_character_flag = scourge_plague_closer
			}
			add_character_flag = scourge_plague_nearby
		}
		else_if = {
			limit = {
				any_neighboring_top_liege_realm_owner = {
					any_neighboring_top_liege_realm_owner = {
						has_character_flag = scourge_plague_splash
					}
				}
			}	
			add_character_flag = scourge_plague_closer
		}
		if = {
			limit = {
				OR = {
					has_character_flag = scourge_plague_closer
					has_character_flag = scourge_plague_nearby
				}
				NOT = {
					has_character_flag = scourge_plague_info_event
				}
			}
			trigger_event = {
				id = wc_scourge_plague.1001
				days = { 2 4 }
			}
		}
	}
}

# The Scourge Plague is closing in
# Used to trigger Scourge Plague Story cycle
wc_scourge_plague.1001 = {
	type = character_event
	title = wc_scourge_plague.1001.t
	desc = wc_scourge_plague.1001.desc
	theme = plague
	override_background = { reference = study }
	left_portrait = {
		character = root
		animation = worry
	}

	trigger = {
		is_ai = no
		is_available_adult = yes
		is_travelling = no
		NOR = {
			any_sub_realm_county = { #Undead Plague is already here, no need to talk about it closing in
				any_county_province = {
					any_province_epidemic = {
						this = global_var:undead_scourge
					}
				}
			}
		}
	}

	on_trigger_fail = {
		trigger_event = {
			id = wc_scourge_plague.1001
			days = { 7 14 }
		}
	}

	immediate = {
		play_music_cue = mx_cue_death
		add_character_flag = scourge_plague_info_event
		if = {
			limit = {
				NOR = {
					has_character_flag = scourge_plague_closer
					has_character_flag = scourge_plague_nearby
				}
			}
			add_character_flag = scourge_plague_closer
		}
		
		hidden_effect = {
			every_sub_realm_county = {
				limit = {
					any_county_province = {
						any_province_epidemic = {
							this = scope:epidemic_scope
						}
					}
				}
			}
		}
	}

	option = { # Ha, let them die!
		name = wc_scourge_plague.1001.a

		trigger = {
			has_trait = callous
		}

		flavor = wc_scourge_plague.1001.a.tt

		stress_impact = {
			base = medium_stress_impact_loss
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_compassion = -1
			}
		}
	}

	option = { # The end times are upon us!
		name = wc_scourge_plague.1001.b

		trigger = {
			has_trait = paranoid
		}

		flavor = wc_scourge_plague.1001.b.tt

		add_character_modifier = {
			modifier = plague_tales
			years = 15
		}

		stress_impact = {
			base = minor_stress_impact_gain
		}

		ai_chance = {
			base = 50
			ai_value_modifier = {
				ai_rationality = 0.5
				ai_greed = -1
			}
		}
	}

	option = { # Oh no
		name =  wc_scourge_plague.1001.c

		stress_impact = {
			base = miniscule_stress_impact_gain
			craven = minor_stress_impact_gain
			paranoid = minor_stress_impact_gain
		}

		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_energy = -0.5
			}
		}
	}
}

wc_scourge_plague.1002 = {
	type = character_event
	window = fullscreen_event
	title = wc_scourge_plague.1002.t
	desc = wc_scourge_plague.1002.desc
	theme = plague
	override_background = { reference = ce1_fullscreen_black_death }
	cooldown = { years = 5 }

	immediate = {
		add_character_flag = scourge_plague_splash
		#play_music_cue = black_death
		add_plague_county_modifiers = yes
		if = {
			limit = {
				any_owned_story = {
					story_type = story_cycle_scourge_plague
				}
			}
			random_owned_story = {
				limit = {
					story_type = story_cycle_scourge_plague
				}
				end_story = yes
			}
		}
	}

	option = {
		name = {
			text = wc_scourge_plague.1002.a
		}
		add_stress = medium_stress_gain
	}

	after = {
		trigger_event = {
			id = health.3001 days = { court_physician_search_min court_physician_search_max }
		}
	}
}