namespace = wc.epidemics 

###############################
#   Vanilla Epidemic Related
#         0001 - 0999
###############################

###############################
#   Scourge of Undeath Related
#         1000 - 1999
###############################

# Plague of Undeath has broken out in your realm

# Plague of Undeath has infected a nearby province

# You have been infected
wc.epidemics.1101 = { 
	
	type = character_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = { is_travelling = yes }
				desc = health.travel.t
			}
			desc = wc.epidemics.1101.t
		}
	}
	desc = {
		desc = wc.epidemics.1101.desc
		triggered_desc = {
			trigger = {
				court_physician_available_trigger = yes
				liege_picks_treatment_trigger = no
			}
			desc = wc.epidemics.1101.court_physician.desc
		}
	}
	theme = healthcare
	override_background = {
		trigger = { is_travelling = yes }
		reference = terrain
	}
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		trigger = {
			NOT = { root = scope:physician }
			trigger_if = {
				limit = { is_travelling = yes }
				current_travel_plan = {
					any_entourage_character = {
						has_court_position = court_physician_court_position
					}
				}
			}
		}
		character = scope:physician
		triggered_animation = {
			trigger = { scope:physician = { health_event_is_worried_trigger = { CHARACTER = scope:sick_character } } }
			animation = worry
		}
		triggered_animation = {
			trigger = { scope:physician = { ai_rationality >= 0 } } #Don't look rational if you're not
			animation = personality_rational
		}
		animation = idle
	}

	override_background = {
		trigger = { is_travelling = yes }
		reference = terrain_travel
	}

	trigger = {
		can_contract_disease_trigger = { DISEASE = plague_of_undeath }
	}

	weight_multiplier = {
		base = 1
		# todo: adjust this
		modifier = {
			health <= fine_health
			factor = 1.1
		}
		modifier = {
			health <= poor_health
			factor = 1.1
		}
		modifier = {
			is_adult = no
			factor = 1.5
		}
		# modifier = {
		# 	# Warcraft
		# 	no_bubonic_plague_year_trigger = yes
			
		# 	factor = 0
		# }
	}

	immediate = {
		play_music_cue = "mx_cue_illness"
		save_court_physician_as_effect = { SCOPE_NAME = physician }
		contract_disease_effect = { DISEASE = bubonic_plague TREATMENT_EVENT = no } #Adds the trait, sends event "health.2101" about contagious disease to liege/host/imprisoner, sends event "health.2201" to those who care
	}

	###NO COURT PHYSICIAN OPTIONS###
	#Find physician
	option = {
		trigger = {
			NOT = { exists = scope:physician }
			is_landed = yes
			is_imprisoned = no 
			is_travelling = no 
		}
		name = health.3101.e
		find_court_physician_effect = yes
		ai_chance = { base = 5 }
	}

	#OK
	option = {
		trigger = {
			exists = scope:physician
			liege_picks_treatment_trigger = yes
		}
		name = wc.epidemics.1101.a
		ai_chance = { base = 1 }
	}
	### TRAVEL- GO HOME
	option = {
		name = health.travel.option.home
		flavor = health.travel.option.home.flavor 
		trigger = {
			is_travelling = yes
			current_travel_plan ={
				travel_plan_owner = root
				can_cancel = yes 
			}
			involved_activity ?= {
				NOR = {
					has_activity_type = activity_tour
					is_required_special_guest = root
				}
			}
		}
		current_travel_plan = { cancel_travel_plan = yes }
		ai_chance = { base = 1 }
	}
	###COURT PHYSICIAN OPTIONS###
	# Not sure there is any treatment for the plague, gonna get rid of these for now
	# #Safe treatment
	# option = {
	# 	trigger = {
	# 		exists = scope:physician
	# 		liege_picks_treatment_trigger = no
	# 		court_physician_available_when_traveling_trigger = yes
	# 	}
	# 	name = health.3101.a
	# 	safe_disease_treatment_effect = { PATIENT = root TREATMENT_PICKER = root }
	# 	ai_chance = { base = 10 }
	# }

	# #Risky treatment
	# option = {
	# 	trigger = {
	# 		exists = scope:physician
	# 		liege_picks_treatment_trigger = no
	# 		court_physician_available_when_traveling_trigger = yes
	# 	}
	# 	name = health.3101.b
	# 	risky_disease_treatment_effect = { PATIENT = root TREATMENT_PICKER = root }
	# 	ai_chance = { base = 1 }
	# }
	
	#Mystic treatment
	option = {
		trigger = {
			court_physician_available_trigger = yes
			liege_picks_treatment_trigger = no
			scope:physician = { has_trait = lifestyle_mystic }
		}
		name = health.3101.c
		mystic_disease_treatment_effect = { PATIENT = root TREATMENT_PICKER = root }
		ai_chance = {
			base = 0.5
			modifier = {
				add = -0.5
				ai_zeal >= 0
			}
		}
	}

	#No treatment
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = { is_travelling = yes }
						desc = health.travel.option.continue
					}
					desc = health.3101.d
				}
			}
		}
		if = {
			limit = {
				exists = scope:physician
				liege_picks_treatment_trigger = no
				court_physician_available_when_traveling_trigger = yes
			}
			no_disease_treatment_effect = yes
		}
		ai_chance = { base = 0 }
	}

	#You're going to rot away in prison most likely
	option = {
		trigger = {
			is_imprisoned = yes 
		}
		name = health.3101.f
	}
}