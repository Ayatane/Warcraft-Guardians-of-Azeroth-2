namespace = drust_crisis

### CRISIS: DRUST INCURSION EVENTS ###
#Gorak Tul invades - triggered by decision
drust_crisis.1 = {
	title = EVTTITLE_WCCRS_130
	desc = EVTDESC_WCCRS_130
	picture = GFX_evt_drustvar
	border = GFX_event_narrative_frame_intrigue

	is_triggered_only = yes

	major = yes
	major_trigger = {
		ai = no
	}
	show_root = yes

	immediate = {
		log = "drust_crisis.1 fired for [Root.GetBestName]"
		save_event_target_as = event_target:target_summoner_of_gorak
		
		set_global_variable = drust_incursion_happened		# Locks the crisis opening event if it didn't happen
		
		create_character = {
			name = Tul
			dynasty = 70201
			culture = drust
			religion = throsic
			attributes = {
				martial=5 diplomacy=5 stewardship=5 intrigue=6 learning=6
			}
			trait=mastermind_theologian
			trait=creature_vrykul
			trait=class_necromancer_9
			trait=cruel trait=patient trait=zealous trait=deceitful trait=being_undead
			trait=gorak_tul_trait
			age = 500
		}
		new_character = {
			save_event_target_as = target_gorak_tul
			# Used in scripted effects
			save_event_target_as = target_settler
			add_artifact = blightreaper
			add_artifact = mantle_of_gorak_tul

			# effect = {
				# set_graphical_culture = vrykul_undead		# Nani is that? There must be no effect!
			# }
			
			set_graphical_culture = vrykul_undead

			create_bloodline = { type = gorak_tul }
			
			c_fates_end = {
				# event_target:target_settler and its people settle here	# without gameover if current ruler is player
				settle_as_target_settler_effect = yes
			}
			
			clear_settler_flag_effect = yes
			
			activate_title = { title = k_drustvar status = yes }
			k_drustvar = { grant_title = event_target:target_gorak_tul }
			
			set_government_type = tribal_monarchy_government
			
			create_character = {
				name = Maloch
				dynasty = 70202
				culture = drust religion = throsic
				attributes = {
					martial=5 diplomacy=4 stewardship=5 intrigue=4 learning=4
				}
				trait=mastermind_theologian
				trait=creature_vrykul
				trait=class_necromancer_5
				trait=zealous trait=cruel trait=proud trait=being_undead
				age = 400
			}
			new_character = {
				set_graphical_culture = vrykul_undead
			}
			
			create_character = {
				name = Drif
				dynasty = 70203
				culture = drust religion = throsic
				attributes = {
					martial=6 diplomacy=3 stewardship=4 intrigue=5 learning=4
				}
				trait=brilliant_strategist
				trait=creature_vrykul
				trait=class_death_knight_5
				trait=zealous trait=sturdy trait=brave trait=wroth trait=being_undead
				age = 400
			}
			new_character = {
				set_graphical_culture = vrykul_undead
			}
			
			create_character = {
				name = Saor
				dynasty = 70204
				culture = drust religion = throsic
				attributes = {
					martial=5 diplomacy=5 stewardship=4 intrigue=4 learning=6
				}
				trait=grey_eminence
				trait=creature_vrykul
				trait=class_druid_5
				trait=zealous trait=shrewd trait=cruel trait=temperate trait=patient trait=being_undead
				age = 400
				add_trait_undead_effect = yes
			}
			new_character = {
				set_graphical_culture = vrykul_undead
			}
		}
		# Make the person that fired the decison a vassal of Gorak Tul
		event_target:target_summoner_of_gorak = {
			if = {
				limit = { character_can_be_vassalized_trigger = yes }
				set_defacto_liege = event_target:target_gorak_tul
			}
		}
		# Declares war against Kul Tiras (wip)
		c_boralus = {
			holder_scope = {
				top_liege = {
					save_event_target_as = target_gorak_tul_enemy
					reverse_war = {
						target = event_target:target_gorak_tul
						casus_belli = invasion
						thirdparty_title = k_kul_tiras
					}
				}
            }
        }
		#Gives troops
		event_target:target_gorak_tul = {
			# Gives money, spawn commanders
			for_war_start_pack_effect = yes
			# Gives troops
			spawn_colonial_troops_effect = yes
			spawn_colonial_troops_effect = yes
			# Gives troops to fight c_boralus's liege
			if = {
				limit = { war = yes }
				location = {
					event_target:target_gorak_tul = {
						spawn_unit = {
							owner = THIS
							province = PREV
							home = PREV
							match_character = event_target:target_gorak_tul_enemy
							match_mult = 1
							match_min = 1500
							match_max = 15000
							attrition = 1.0
							maintenance = no
						}
					}
				}
			}
		}
		
		
		# The Thornspeakers take action
		73 = { province_event = { id = WCCRS.149 days = 7 } }
	}

	option = {
		name = EVTOPTA_WCCRS_130
	}
	
	option = {
		trigger = {
			ai = no
			event_target:target_gorak_tul = { ai = yes }
			
			character = event_target:target_summoner_of_gorak
		}
		name = EVTOPTB_WCCRS_130
		
		set_player_character = event_target:target_gorak_tul
	}
}