namespace = wc_elemental_story_events
#################################
###### Ritual: Planar Fire ######
########### By Dione ############
#################################
# 001 - 100 Planar Fire: Spirit #
# 101 - 200 Planar Fire: Decay  #
#################################

wc_elemental_story_events.001 = {
	title = wc_elemental_story_events.001.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = planar_fire_spirit
				}
				desc = wc_elemental_story_events.001.d_returned
			}
		}
		desc = wc_elemental_story_events.001.d
	}

	theme = elemental_fire
	override_background = { reference = bp1_bonfire }

	immediate = {
		add_prestige = 50
		if = {
			limit = {
				NOT = { has_variable = wc_elemental_fire_favour_variable }
			}
			set_variable = { name = wc_$ELEMENT$_favour_variable value = wc_starting_elemental_fire_favour_value }
		}
	}

	option = {
		name = wc_elemental_story_events.001.a
		random_list = {
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen
					days = 10
				}
				desc = wc_elements_listen
				custom_tooltip = wc_gift_power_increase
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				desc = wc_elements_dont_listen
				custom_tooltip = wc_gift_power_decrease
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}
	}

	after = {
		trigger_event = { 
			id = wc_elemental_story_events.002
			days = { 5 10 }
		}
	}
}

wc_elemental_story_events.002 = { # Round 1 Asking
	title = wc_elemental_story_events.001.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = elements_listen
				}
				desc = wc_elemental_story_events.002.success
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = elements_listen }
				}
				desc = wc_elemental_story_events.002.failure
			}
		}
	}

	theme = elemental_fire
	override_background = { reference = bp1_bonfire }

	immediate = {
		set_variable = {
			name = elemental_fire_cycle_mult
			value = 1
		}
		if = {
			limit = {
				has_character_flag = elements_listen
			}
			change_variable = {
				name = elemental_fire_cycle_mult
				add = 0.5
			}
		}
	}

	option = { # Ask for Protection
		name = wc_elemental_story_events.002.protection
		random_list = {
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen
					days = 10
				}
				desc = wc_gift_power_big
				add_character_modifier = {
					modifier = wc_elemental_fire_major_protection_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				add_character_modifier = {
					modifier = wc_elemental_fire_minor_protection_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				desc = wc_gift_power_good
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}
	}
	option = { # Ask for Efficiency
		name = wc_elemental_story_events.002.efficiency
		random_list = {
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen
					days = 10
				}
				desc = wc_gift_power_big
				add_character_modifier = {
					modifier = wc_elemental_fire_major_efficiency_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				add_character_modifier = {
					modifier = wc_elemental_fire_minor_efficiency_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				desc = wc_gift_power_good
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}
	}
	option = { # Ask for Companionship
		name = wc_elemental_story_events.002.companionship
		random_list = {
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen
					days = 10
				}
				desc = wc_gift_power_big
				add_character_modifier = {
					modifier = wc_elemental_fire_major_companionship_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				add_character_modifier = {
					modifier = wc_elemental_fire_minor_companionship_modifier
					days = wc_spell_planar_fire_duration_days_value
				}
				desc = wc_gift_power_good
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}
	}

	after = {
		trigger_event = { 
			id = wc_elemental_story_events.003
			days = { 5 10 }
		}
	}
}

wc_elemental_story_events.003 = { # Commune again
	title = wc_elemental_story_events.003.t
	desc = wc_elemental_story_events.003.d

	theme = elemental_fire
	override_background = { reference = bp1_bonfire }


	option = { # Offer Gold
		name = wc_elemental_story_events.003.a
		remove_short_term_gold = 25
		random_list = {
			50 = {
				modifier = {
					factor = 1.5
					has_trait = greedy
				}
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen2
					days = 10
				}
				desc = wc_element_offering_good
				custom_tooltip = wc_gift_power_increase
				change_variable = {
					name = elemental_fire_cycle_mult
					add = 0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				desc = wc_element_offering_bad
				custom_tooltip = wc_gift_power_decrease
				change_variable = {
					name = elemental_fire_cycle_mult
					add = -0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}

		stress_impact = {
			greedy = medium_stress_impact_gain
			generous = medium_stress_impact_loss
			improvident = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = greedy
				add = -50
			}
			modifier = {
				OR = {
					has_trait = improvident
					has_trait = generous
				}
				add = 50
			}
		}
	}

	option = { # Offer Sacrifice
		name = wc_elemental_story_events.003.b
		random_courtier_or_guest = {
			override_death_killer_effect = {
				death_reason = death_execution
				killer = root
			}
		}

		random_list = {
			50 = {
				modifier = {
					factor = 1.5
					has_trait = compassionate
				}
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = 15
					}
					wc_elemental_fire_favour_script_var > 0
				}
				add_character_flag = {
					flag = elements_listen2
					days = 10
				}
				desc = wc_element_offering_good
				custom_tooltip = wc_gift_power_increase
				change_variable = {
					name = elemental_fire_cycle_mult
					add = 0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				desc = wc_element_offering_bad
				custom_tooltip = wc_gift_power_decrease
				change_variable = {
					name = elemental_fire_cycle_mult
					add = -0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}

		stress_impact = {
			compassionate = medium_stress_impact_gain
			callous = medium_stress_impact_loss
			just = medium_stress_impact_gain
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = callous
				add = 50
			}
			modifier = {
				OR = {
					has_trait = compassionate
					has_trait = just
				}
				add = -50
			}
		}
	}

	option = { # Offer Loyalty
		name = wc_elemental_story_events.003.c
		random_list = {
			50 = {
				modifier = {
					factor = 2
					wc_elemental_fire_favour_script_var >= 40
				}
				modifier = {
					factor = 1.5
					wc_elemental_fire_favour_script_var >= 30
				}
				modifier = {
					factor = 1.2
					wc_elemental_fire_favour_script_var >= 20
				}
				add_character_flag = {
					flag = elements_listen2
					days = 10
				}
				
				desc = wc_element_offering_good
				custom_tooltip = wc_gift_power_increase
				change_variable = {
					name = elemental_fire_cycle_mult
					add = 0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
			50 = {
				modifier = {
					factor = {
						value = wc_elemental_fire_favour_script_var
						divide = -15
					}
					wc_elemental_fire_favour_script_var < 0
				}
				modifier = {
					factor = 1.3
					wc_elemental_fire_favour_script_var <= 20
				}
				desc = wc_element_offering_bad
				custom_tooltip = wc_gift_power_decrease
				change_variable = {
					name = elemental_fire_cycle_mult
					add = -0.5
				}
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = -49
				}
			}
		}

		stress_impact = {
			disloyal = medium_stress_impact_gain
			loyal = medium_stress_impact_loss
		}

		ai_chance = {
			base = 100
			modifier = {
				has_trait = loyal
				add = 50
			}
			modifier = {
				has_trait = disloyal
				add = -50
			}
		}
	}

	after = {
		trigger_event = { 
			id = wc_elemental_story_events.004
			days = { 5 10 }
		}
	}
}

wc_elemental_story_events.004 = { # Round 2 Asking
	title = wc_elemental_story_events.003.t
	desc = {
		desc = wc_elemental_story_events.004.d
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = elements_listen2
				}
				desc = wc_elemental_story_events.002.success
			}
			triggered_desc = {
				trigger = {
					NOT = { has_character_flag = elements_listen }
				}
				desc = wc_elemental_story_events.002.failure
			}
		}
		desc = wc_elemental_story_events.004.d_outro
	}

	theme = elemental_fire
	override_background = { reference = bp1_bonfire }

	option = { # Fear me
		name = wc_elemental_story_events.004.a
		add_character_modifier = {
			modifier = wc_elemental_fire_fear_me_modifier
			days = wc_spell_planar_fire_duration_days_value
		}
		ai_chance = {
			base = 100
			modifier = {
				has_trait = callous
				add = 50
			}
			modifier = {
				has_trait = compassionate
				add = -50 
			}
		}
	}

	option = { # Fear me
		name = wc_elemental_story_events.004.b
		add_character_modifier = {
			modifier = wc_elemental_fire_love_me_modifier
			days = wc_spell_planar_fire_duration_days_value
		}
		ai_chance = {
			base = 100
			modifier = {
				has_trait = callous
				add = -50
			}
			modifier = {
				has_trait = compassionate
				add = 50 
			}
		}
	}

	after = {
		trigger_event = { 
			id = wc_elemental_story_events.005
			days = { 5 10 }
		}
	}
}

wc_elemental_story_events.005 = { # Actual big bonus time
	title = wc_elemental_story_events.005.t
	desc = wc_elemental_story_events.005.desc
	theme = elemental_fire
	override_background = { reference = bp1_bonfire }

	option = {
		name = wc_elemental_story_events.005.a
		add_character_modifier = {
			modifier = wc_elemental_fire_planar_fire_modifier
			days = wc_spell_planar_fire_duration_days_value
		}
		custom_tooltip = wc_planar_fire_cd_reset
		if = {
			limit = {
				has_list = spells_cd
			}
			every_in_list = {
				variable = spells_cd
				save_scope_as = le_spell
				if = {
					limit = {
						root = {
							NOT = {
								spell_is_ritual_trigger = { SPELL = scope:le_spell }
							}
						}
					}
					root = {
						remove_list_variable = {
							name = spells_cd
							target = scope:le_spell
						}
					}
				}
			}
		}
		save_scope_value_as = {
			name = mp_new_val
			value = {
				add = wc_elemental_fire_favour_script_var
				divide = 5
				multiply = var:elemental_fire_cycle_mult
			}
		}
		wc_change_amount_mp_effect = {
			CHANGE = add
			VALUE = scope:mp_new_val
		}
		remove_variable = elemental_fire_cycle_mult
	}
}