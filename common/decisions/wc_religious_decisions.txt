# Largely copied from appoint_a_righteous_caliph_decision
separate_from_zul_religious_leadership = { 
	ai_check_interval = 12
	major = yes
	# PIC CREDIT https://phillipzhang.artstation.com/
	picture = "gfx/interface/illustrations/decisions/zulian_restoration.dds" # Temp
	selection_tooltip = separate_from_zul_religious_leadership_decision_tt

	is_shown = {
		is_landed = yes
		religion = religion:loa_group
		exists = faith.religious_head
		NOT = { faith = faith.religious_head.faith }
	}

	is_valid = { 
		# Must be independent.
		is_independent_ruler = yes
		# Should have a decent piety level.
		piety_level >= high_piety_level
		# Must have a decent proportion of sub-realm counties of the faith.
		# custom_description = {
		# 	text = appoint_a_righteous_caliph_decision.need_at_least_ten_same_faith_counties
		# 	any_sub_realm_county = {
		# 		count >= appoint_a_righteous_caliph_decision_same_faith_county_count
		# 		faith = root.faith
		# 	}
		# }
		# Plus, you shouldn't be _too_ sinful, even with your piety level.
		custom_description = {
			text = appoint_a_righteous_caliph_decision.no_more_than_x_sinful_traits
			num_sinful_traits <= 2
		}
		# Now, pick any two of the valid reasons.
		calc_true_if = {
			amount >= 2
			
			# Being outside of your head's diplo range helps.
			custom_description = {
				text = appoint_a_righteous_caliph_decision.caliph_not_in_diplo_range
				NOT = { in_diplomatic_range = faith.religious_head }
			}
			# Having a holy site.
			custom_description = {
				text = appoint_a_righteous_caliph_decision.control_one_holy_site
				faith = {
					any_holy_site = {
						count >= 1
						holder.top_liege = root
					}
				}
			}
			# Having *2* holy sites.
			custom_description = {
				text = appoint_a_righteous_caliph_decision.control_two_holy_sites
				faith = {
					any_holy_site = {
						count >= 2
						holder.top_liege = root
					}
				}
			}
			# Having a higher-than-minimum piety level.
			piety_level >= very_high_piety_level
			# And just having a caliph who doesn't live up to the root's faith's ideals.
			custom_description = {
				text = appoint_a_righteous_caliph_decision.caliph_has_x_or_more_traits_sinful_to_your_faith
				faith.religious_head = {
					num_sinful_traits = {
						value >= 2
						faith = root.faith
					}
				}
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		# Has to be around for the ceremony.
		not = { exists = involved_activity }
		has_contagious_deadly_disease_trigger = no
		is_at_war = no
	}

	effect = {
		save_scope_as = founder
		faith.religious_head = {
			save_scope_as = old_religious_head
		}
		create_character = {
			template = priest_character_template
			dynasty = none
			location = scope:founder.location
			save_scope_as = new_religious_head
		}

		custom_description = {
			text = separate_from_zul_new_hof
			separate_from_zul_new_hof_effect = yes
		}

		separate_from_zul_other_effect = yes
	}

	cost = {
		gold = 500
		piety = 1000
	}

	ai_potential = {
		# Must be independent.
		is_independent_ruler = yes
		# Should have a decent piety level.
		piety_level >= high_piety_level
		OR = {
			# Zealous people think they know better.
			has_trait = zealous
			# And cynics want that power for themselves.
			has_trait = cynical

			opinion = {
				target = faith.religious_head
				value < -25
			}
		}
	}

	ai_will_do = {
		base = 100
	}

}