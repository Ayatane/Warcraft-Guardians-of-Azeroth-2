confidants_secrecy_mitigation_max = 10
dreadful_secrecy_mitigation_max = 10

# this will be added on top of event and spellcast expose effects, meaning its effects are secondary to those that directly affect them. 
wc_magic_secrecy_defense_base_value = { 
	min = 0
	max = 100

	#additions from perks
	if = { 
		limit = { has_perk = court_of_shadows_perk } # intrigue
		add = -5
	}
	if = { 
		limit = { has_perk = dignitas_perk } # diplomacy
		add = -5
	}
	if = { 
		limit = { has_perk = shadow_magic_tree_1_perk_5 } # dark bargain >;]
		add = -5
	}

	# additions from lifestyle focuses
	if = { 
		limit = { has_focus =  shadow_magic_focus_3 } # doomsayer
		add = -5
	}
	else_if = { 
		limit = { has_focus =  disorder_magic_focus_1 } # corruptor
		add = -5
	}
	else_if = { 
		limit = { has_focus =  death_magic_focus_2 } # deathbringer
		add = -5
	}

	#infusion will go here, +33% per rank
}

# this is used in events and spells together because they are self initiated acts. there will be a separate one for scheme and spell secrecy defense
# eventually spellcast and event could be separated out
# - see wc_event_chance_to_expose_secret_effect and wc_expose_magic_spellcast_effect for use of the value
# - events supply their own expose chance to which provides a base that this value is then added to.
# - spellcasting is much more complex and takes into account variables such as spell rank 
wc_event_spellcast_chance_to_expose_magic_secret_value = { 
	min = 0
	max = 100

	# court mage also illegal magic user
	if = { 
		limit = { 
			employs_court_position = court_mage_court_position
			any_court_position_holder = { 
				type = court_mage_court_position
				any_secret = { 
					is_magic_secret_trigger = yes
				}
			}
		}
		add = -5
	}

	# traits
	if = { limit = { has_trait = scholar } 
		add = -5
	}

	# perks
	if = { limit = { has_perk = hard_rule_perk } # military
		add = -5
	}
	if = { limit = { has_perk = loyalty_and_respect_perk } #military
		add = -5
	}
	if = { limit = { has_perk = toe_the_line_perk } # stewardship
		add = -5
	}
	if = { limit = { has_perk = death_magic_tree_1_perk_3 } # frost presence
		add = -5
	}
	if = { limit = { has_perk = life_magic_tree_2_perk_2 } # law of the jungle
		add = -5
	}
	if = { limit = { has_perk = order_magic_tree_1_perk_7 } # synergistic alacrity (TODO: change to another order perk, this makes little sense -SS)
		add = -5
	}
	if = { limit = { has_perk = shadow_magic_tree_1_perk_5 } # cthonic silence
		add = -5
	}

	# special perks
	add = confidants_secrecy_mitigation_value
	add = dreadful_secrecy_mitigation_value
	
	# focuses
	if = { 
		limit = { has_focus = light_magic_focus_1 } # initiate
		add = -5
	}
	if = { 
		limit = { has_focus = life_magic_focus_1 } # feral
		add = -5
	}
	if = { 
		limit = { has_focus = order_magic_focus_2 } # abjurer
		add = -5
	}
	if = { 
		limit = { has_focus = elemental_fire_magic_focus_1 } # hearthkeeper
		add = -5
	}
	if = { 
		limit = { has_focus = elemental_water_magic_focus_1 } # watershaper
		add = -5
	}
	if = { 
		limit = { has_focus = elemental_earth_magic_focus_2 } # terramancer
		add = -5
	}
	if = { 
		limit = { has_focus = elemental_air_magic_focus_1 } # windcaller
		add = -5
	}

	# character variable - this comes from random magic secret events and can be positive or negative
	if = { 
		limit = { exists = var:wc_magic_secret_expose_chance }
		add = var:wc_magic_secret_expose_chance
	}

	# overall modifier
	add = wc_magic_secrecy_defense_base_modifier
}

confidants_secrecy_mitigation_value = { 
	value = 0
	if = {
		limit = {
			has_perk = confidants_perk
		}
		save_temporary_scope_as = confidant_scope 
		every_relation = {
			type = friend
			add_to_temporary_list = confidant_friend_list
		}
		every_in_list = {
			list = confidant_friend_list
			scope:confidant_scope = {
				add = 1
			}
		}
	}
	max = confidants_secrecy_mitigation_max
}

dreadful_secrecy_mitigation_value = { 
	value = dread
	multiply = 0.1
	max = 10
}