plague_of_undeath =  {

	color = { 200 0 175 }
	shader_data = {
		strength = 0.8
		edge_fade = 0.4
		tile_multiplier = 0.005
		texture_index = 0
		channel = red
	}
	priority = 5

	trait = bubonic_plague # TODO: change this!

	name = { 
		first_valid = { 
			triggered_desc = { 
				trigger = { 
					outbreak_province = { 
						has_variable = uniqe_epidemic_loc
					}
					# var:uniqe_epidemic_loc = flag:plague_test
				}

				desc = epidemic_plague_test_loc
			}
			triggered_desc = { 
				trigger = { 
					outbreak_intensity = minor
				}
				random_valid = { 
					desc = epidemic_scourge_of_province_loc
					desc = epidemic_undead_plague_of_province_loc
					desc = epidemic_grave_curse_of_province_loc
					desc = epidemic_deathwalking_of_province_loc
					desc = epidemic_wrath_of_death_god_loc
				}
			}
			random_valid = { 
				desc = epidemic_scourge_of_realm_loc
				desc = epidemic_undead_plague_of_realm_loc
				desc = epidemic_grave_curse_of_realm_loc
				desc = epidemic_deathwalking_of_realm_loc
				desc = epidemic_death_god_plague_loc
			}
		}
	}

	can_infect_character = { 
		# other characteristics here if needed
		NOR = {
			has_character_modifier = important_lore_character # not sure if this is right
			has_trait_with_flag = can_not_get_sick
		}
		is_vulnerable_to_plague_trigger = yes
	}

	character_infection_chance = {
		value = character_infection_chance_default_value
		# note that bubonic plague is multiplied by 0.02 here, if too many are undeading do something like that here
		# also note that LE1+ characters dont get mitigation from this
		multiply = wc_lore_plague_mitigations_reduction
	}

	on_character_infected = { 
		trigger_event = { id = wc.epidemic.1101 days = { 3 7 } }
	}

	on_start = { 
		if = { 
			limit = { 
				outbreak_province = { 
					has_variable = uniqe_epidemic_loc
				}
			}
			set_variable = { 
				name = uniqe_epidemic_loc
				value = outbreak_province.var:uniqe_epidemic_loc
			}
			outbreak_province = { 
				remove_variable = uniqe_epidemic_loc
			}
		}
	}

	on_monthly = { 
		# TODO: add a set of events related to this.
	}

	on_end = { 
		# do something here?
	}

	# Every province has an infection level from 0-100, the highest level there they are above the threshold of
	# will have its modifiers applied
	infection_levels = { # TODO - figure out what to do here, borrowing from bubonic plague for now
		10 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.6
				development_decline = -3
				levy_reinforcement_rate = -0.3
				levy_size = -0.25
				supply_limit_mult = -0.2
				county_opinion_add = -10
				epidemic_travel_danger = 25
			}	
		}
		50 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.8
				development_decline = -6
				levy_reinforcement_rate = -0.5
				levy_size = -0.4
				supply_limit_mult = -0.5
				county_opinion_add = -25
				epidemic_travel_danger = 40
			}	
		}
		80 = {
			province_modifier = {
				monthly_county_control_decline_add = -0.8
				development_decline = -8
				levy_reinforcement_rate = -1
				levy_size = -0.5
				supply_limit_mult = -1
				county_opinion_add = -25
				epidemic_travel_danger = 60
			}
		}
	}

	outbreak_intensities = {
		# Intensity levels are minor, major and apocalytpic, each can be read in separately
		# Higher intensity levels are kept when neighboring epidemics merge.

		minor = {
			# Chance for an outbreak of this intensity to spawn on a province per year
			# % from 0-100 inclusive
			# root = potential province
			# scope:epidemic_type = this epidemic type
			outbreak_chance = {
				value = 0 # this normally should never happen
				if = { 
					limit = { 
						county = { 
							any_neighboring_county = { 
								religion = religion:deathbringer
							}
						}
					}
					add = 0.5 # can rarely occur if you got undead neighbors though
				}
			}

			# Chance for an epidemic of this intensity to spread to an adjacent province per month
			# % from 0-100 inclusive
			# root = potential province
			# scope:epidemic = the epidemic
			spread_chance = {
				
			}

			# Maximum number of provinces an epidemic of this intensity can infect
			max_provinces = { 10 20 }

			# How long an infection in a province lasts for once it hits max infection
			# root = infected province
			# scope:epidemic = the epidemic
			infection_duration = {
				<scripted_duration>
			}

			# How many days it will take for a province to hit max infection
			# root = infected province
			# scope:epidemic = the epidemic
			infection_progress_duration = {
				<scripted_duration>
			}

			# How many days it will take for a province to recover from max infection after infection_duration has elapsed
			# root = infected province
			# scope:epidemic = the epidemic
			infection_recovery_duration = {
				<scripted_duration>
			}
		}
	}
}