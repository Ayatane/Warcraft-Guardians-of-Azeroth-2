wc_remove_all_wc_lifestyle_traits_effect = {
	
	switch = { # Light
		trigger = has_trait

		user_of_light_magic_1 = { remove_trait = user_of_light_magic_1 }
		user_of_light_magic_2 = { remove_trait = user_of_light_magic_2 }
		user_of_light_magic_3 = { remove_trait = user_of_light_magic_3 }
		user_of_light_magic_4 = { remove_trait = user_of_light_magic_4 }
		user_of_light_magic_5 = { remove_trait = user_of_light_magic_5 }
	}
	switch = { # Shadow
		trigger = has_trait

		user_of_shadow_magic_1 = { remove_trait = user_of_shadow_magic_1 }
		user_of_shadow_magic_2 = { remove_trait = user_of_shadow_magic_2 }
		user_of_shadow_magic_3 = { remove_trait = user_of_shadow_magic_3 }
		user_of_shadow_magic_4 = { remove_trait = user_of_shadow_magic_4 }
		user_of_shadow_magic_5 = { remove_trait = user_of_shadow_magic_5 }
	}
	switch = { # Disorder
		trigger = has_trait

		user_of_disorder_magic_1 = { remove_trait = user_of_disorder_magic_1 }
		user_of_disorder_magic_2 = { remove_trait = user_of_disorder_magic_2 }
		user_of_disorder_magic_3 = { remove_trait = user_of_disorder_magic_3 }
		user_of_disorder_magic_4 = { remove_trait = user_of_disorder_magic_4 }
		user_of_disorder_magic_5 = { remove_trait = user_of_disorder_magic_5 }
	}
	switch = { # Order
		trigger = has_trait

		user_of_order_magic_1 = { remove_trait = user_of_order_magic_1 }
		user_of_order_magic_2 = { remove_trait = user_of_order_magic_2 }
		user_of_order_magic_3 = { remove_trait = user_of_order_magic_3 }
		user_of_order_magic_4 = { remove_trait = user_of_order_magic_4 }
		user_of_order_magic_5 = { remove_trait = user_of_order_magic_5 }
	}
	switch = { # Life
		trigger = has_trait

		user_of_life_magic_1 = { remove_trait = user_of_life_magic_1 }
		user_of_life_magic_2 = { remove_trait = user_of_life_magic_2 }
		user_of_life_magic_3 = { remove_trait = user_of_life_magic_3 }
		user_of_life_magic_4 = { remove_trait = user_of_life_magic_4 }
		user_of_life_magic_5 = { remove_trait = user_of_life_magic_5 }
	}
	switch = { # Death
		trigger = has_trait

		user_of_death_magic_1 = { remove_trait = user_of_death_magic_1 }
		user_of_death_magic_2 = { remove_trait = user_of_death_magic_2 }
		user_of_death_magic_3 = { remove_trait = user_of_death_magic_3 }
		user_of_death_magic_4 = { remove_trait = user_of_death_magic_4 }
		user_of_death_magic_5 = { remove_trait = user_of_death_magic_5 }
	}
	switch = { # Fire
		trigger = has_trait

		user_of_elemental_fire_magic_1 = { remove_trait = user_of_elemental_fire_magic_1 }
		user_of_elemental_fire_magic_2 = { remove_trait = user_of_elemental_fire_magic_2 }
		user_of_elemental_fire_magic_3 = { remove_trait = user_of_elemental_fire_magic_3 }
		user_of_elemental_fire_magic_4 = { remove_trait = user_of_elemental_fire_magic_4 }
		user_of_elemental_fire_magic_5 = { remove_trait = user_of_elemental_fire_magic_5 }

		user_of_elemental_fire_spirit_magic_1 = { remove_trait = user_of_elemental_fire_spirit_magic_1 }
		user_of_elemental_fire_spirit_magic_2 = { remove_trait = user_of_elemental_fire_spirit_magic_2 }
		user_of_elemental_fire_spirit_magic_3 = { remove_trait = user_of_elemental_fire_spirit_magic_3 }
		user_of_elemental_fire_spirit_magic_4 = { remove_trait = user_of_elemental_fire_spirit_magic_4 }
		user_of_elemental_fire_spirit_magic_5 = { remove_trait = user_of_elemental_fire_spirit_magic_5 }

		user_of_elemental_fire_decay_magic_1 = { remove_trait = user_of_elemental_fire_decay_magic_1 }
		user_of_elemental_fire_decay_magic_2 = { remove_trait = user_of_elemental_fire_decay_magic_2 }
		user_of_elemental_fire_decay_magic_3 = { remove_trait = user_of_elemental_fire_decay_magic_3 }
		user_of_elemental_fire_decay_magic_4 = { remove_trait = user_of_elemental_fire_decay_magic_4 }
		user_of_elemental_fire_decay_magic_5 = { remove_trait = user_of_elemental_fire_decay_magic_5 }
	}
	switch = { # Water
		trigger = has_trait

		user_of_elemental_water_magic_1 = { remove_trait = user_of_elemental_water_magic_1 }
		user_of_elemental_water_magic_2 = { remove_trait = user_of_elemental_water_magic_2 }
		user_of_elemental_water_magic_3 = { remove_trait = user_of_elemental_water_magic_3 }
		user_of_elemental_water_magic_4 = { remove_trait = user_of_elemental_water_magic_4 }
		user_of_elemental_water_magic_5 = { remove_trait = user_of_elemental_water_magic_5 }

		user_of_elemental_water_spirit_magic_1 = { remove_trait = user_of_elemental_water_spirit_magic_1 }
		user_of_elemental_water_spirit_magic_2 = { remove_trait = user_of_elemental_water_spirit_magic_2 }
		user_of_elemental_water_spirit_magic_3 = { remove_trait = user_of_elemental_water_spirit_magic_3 }
		user_of_elemental_water_spirit_magic_4 = { remove_trait = user_of_elemental_water_spirit_magic_4 }
		user_of_elemental_water_spirit_magic_5 = { remove_trait = user_of_elemental_water_spirit_magic_5 }

		user_of_elemental_water_decay_magic_1 = { remove_trait = user_of_elemental_water_decay_magic_1 }
		user_of_elemental_water_decay_magic_2 = { remove_trait = user_of_elemental_water_decay_magic_2 }
		user_of_elemental_water_decay_magic_3 = { remove_trait = user_of_elemental_water_decay_magic_3 }
		user_of_elemental_water_decay_magic_4 = { remove_trait = user_of_elemental_water_decay_magic_4 }
		user_of_elemental_water_decay_magic_5 = { remove_trait = user_of_elemental_water_decay_magic_5 }
	}
	switch = { # Air
		trigger = has_trait

		user_of_elemental_air_magic_1 = { remove_trait = user_of_elemental_air_magic_1 }
		user_of_elemental_air_magic_2 = { remove_trait = user_of_elemental_air_magic_2 }
		user_of_elemental_air_magic_3 = { remove_trait = user_of_elemental_air_magic_3 }
		user_of_elemental_air_magic_4 = { remove_trait = user_of_elemental_air_magic_4 }
		user_of_elemental_air_magic_5 = { remove_trait = user_of_elemental_air_magic_5 }

		user_of_elemental_air_spirit_magic_1 = { remove_trait = user_of_elemental_air_spirit_magic_1 }
		user_of_elemental_air_spirit_magic_2 = { remove_trait = user_of_elemental_air_spirit_magic_2 }
		user_of_elemental_air_spirit_magic_3 = { remove_trait = user_of_elemental_air_spirit_magic_3 }
		user_of_elemental_air_spirit_magic_4 = { remove_trait = user_of_elemental_air_spirit_magic_4 }
		user_of_elemental_air_spirit_magic_5 = { remove_trait = user_of_elemental_air_spirit_magic_5 }

		user_of_elemental_air_decay_magic_1 = { remove_trait = user_of_elemental_air_decay_magic_1 }
		user_of_elemental_air_decay_magic_2 = { remove_trait = user_of_elemental_air_decay_magic_2 }
		user_of_elemental_air_decay_magic_3 = { remove_trait = user_of_elemental_air_decay_magic_3 }
		user_of_elemental_air_decay_magic_4 = { remove_trait = user_of_elemental_air_decay_magic_4 }
		user_of_elemental_air_decay_magic_5 = { remove_trait = user_of_elemental_air_decay_magic_5 }
	}
	switch = { # Earth
		trigger = has_trait

		user_of_elemental_earth_magic_1 = { remove_trait = user_of_elemental_earth_magic_1 }
		user_of_elemental_earth_magic_2 = { remove_trait = user_of_elemental_earth_magic_2 }
		user_of_elemental_earth_magic_3 = { remove_trait = user_of_elemental_earth_magic_3 }
		user_of_elemental_earth_magic_4 = { remove_trait = user_of_elemental_earth_magic_4 }
		user_of_elemental_earth_magic_5 = { remove_trait = user_of_elemental_earth_magic_5 }

		user_of_elemental_earth_spirit_magic_1 = { remove_trait = user_of_elemental_earth_spirit_magic_1 }
		user_of_elemental_earth_spirit_magic_2 = { remove_trait = user_of_elemental_earth_spirit_magic_2 }
		user_of_elemental_earth_spirit_magic_3 = { remove_trait = user_of_elemental_earth_spirit_magic_3 }
		user_of_elemental_earth_spirit_magic_4 = { remove_trait = user_of_elemental_earth_spirit_magic_4 }
		user_of_elemental_earth_spirit_magic_5 = { remove_trait = user_of_elemental_earth_spirit_magic_5 }

		user_of_elemental_earth_decay_magic_1 = { remove_trait = user_of_elemental_earth_decay_magic_1 }
		user_of_elemental_earth_decay_magic_2 = { remove_trait = user_of_elemental_earth_decay_magic_2 }
		user_of_elemental_earth_decay_magic_3 = { remove_trait = user_of_elemental_earth_decay_magic_3 }
		user_of_elemental_earth_decay_magic_4 = { remove_trait = user_of_elemental_earth_decay_magic_4 }
		user_of_elemental_earth_decay_magic_5 = { remove_trait = user_of_elemental_earth_decay_magic_5 }
	}
}

wc_nonelemental_MAGIC_magic_lifestyle_rank_up_check_effect = { # Used for perks
	# Magic Secrecy - We get the secret if we arent openly learning it yet
	if = { 
		limit = { 
			NOT = { 
				has_trait = wc_lifestyle_$MAGIC$_magic 
				can_openly_learn_magic_type_trigger = { MAGICTYPE = $MAGIC$ }
				is_secret_magic_type_user = { MAGICTYPE = $MAGIC$ }
			}
		}
		add_secret = { 
			type = secret_$MAGIC$_magic_user
		}
	} 
	# Trait maintenance - We determine if traits need to rank up or be added
	else_if = {
		limit = {
			OR = { # bypass this block if this magic is illegal and we do not have this kind of trait already
				can_openly_learn_magic_type_trigger = { MAGICTYPE = $MAGIC$ }
				has_trait = wc_lifestyle_$MAGIC$_magic
			}
			NOT = { has_trait = user_of_$MAGIC$_magic_5 } # Max level
		}

		hidden_effect = {
			wc_magic_lifestyle_rank_up_effect = { MAGIC = $MAGIC$ }
		}
	}
	# Mana maintenance
	wc_start_mana_regeneration_loop_effect = yes # It can be character's first perk
	wc_fill_mana_on_day_one_from_perks_crutch_effect = yes
	wc_start_hp_regeneration_loop_effect = yes
	# On action maintenance
	trigger_event = { on_action = on_perk_gained }
}

#called in the function above and when secrets are exposed
wc_magic_lifestyle_rank_up_effect = { 
	if = {
		limit = { 
			NOT = { 
				has_trait = wc_lifestyle_$MAGIC$_magic
			}  
			$MAGIC$_magic_lifestyle_perks > 0
		}

		add_trait = user_of_$MAGIC$_magic_1
	}
	if = {
		limit = {
			$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_2_magic_trait_value
			has_trait = user_of_$MAGIC$_magic_1
		}

		change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
	}
	if = {
		limit = {
			$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_3_magic_trait_value
			has_trait = user_of_$MAGIC$_magic_2
		}

		change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
	}
	if = {
		limit = {
			$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_4_magic_trait_value
			has_trait = user_of_$MAGIC$_magic_3
		}

		change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
	}
	if = {
		limit = {
			$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_4_magic_trait_value
			has_trait = user_of_$MAGIC$_magic_3
		}

		change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
	}
	if = {
		limit = {
			$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_5_magic_trait_value
			has_trait = user_of_$MAGIC$_magic_4
		}

		change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 }
	}
}

wc_magic_lifestyle_secret_reveal_effect = { 
	if = { limit = { scope:secret = { secret_type = secret_disorder_magic_user } }
		wc_magic_lifestyle_rank_up_effect = { MAGIC = disorder }
	}
}


wc_elemental_MAGIC_magic_lifestyle_rank_up_check_effect = {
	# Trait maintenance
	if = {
		limit = {
			NOT = { # Max level
				has_trait = user_of_$MAGIC$_magic_5
				has_trait = user_of_$MAGIC$_spirit_magic_5
				has_trait = user_of_$MAGIC$_decay_magic_5
			}
		}

		hidden_effect = {
			if = {
				limit = {
					$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_5_magic_trait_value
					OR = {
						has_trait = user_of_$MAGIC$_magic_4
						has_trait = user_of_$MAGIC$_spirit_magic_4
						has_trait = user_of_$MAGIC$_decay_magic_4
					}
				}

				switch = {
					trigger = has_trait

					user_of_$MAGIC$_magic_4 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 } }
					user_of_$MAGIC$_spirit_magic_4 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_spirit_magic rank = 1 } }
					user_of_$MAGIC$_decay_magic_4 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_decay_magic rank = 1 } }
				}
			}
			else_if = {
				limit = {
					$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_4_magic_trait_value
					OR = {
						has_trait = user_of_$MAGIC$_magic_3
						has_trait = user_of_$MAGIC$_spirit_magic_3
						has_trait = user_of_$MAGIC$_decay_magic_3
					}
				}

				switch = {
					trigger = has_trait

					user_of_$MAGIC$_magic_3 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 } }
					user_of_$MAGIC$_spirit_magic_3 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_spirit_magic rank = 1 } }
					user_of_$MAGIC$_decay_magic_3 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_decay_magic rank = 1 } }
				}
			}
			else_if = {
				limit = {
					$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_3_magic_trait_value
					OR = {
						has_trait = user_of_$MAGIC$_magic_2
						has_trait = user_of_$MAGIC$_spirit_magic_2
						has_trait = user_of_$MAGIC$_decay_magic_2
					}
				}

				switch = {
					trigger = has_trait

					user_of_$MAGIC$_magic_2 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 } }
					user_of_$MAGIC$_spirit_magic_2 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_spirit_magic rank = 1 } }
					user_of_$MAGIC$_decay_magic_2 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_decay_magic rank = 1 } }
				}
			}
			else_if = {
				limit = {
					$MAGIC$_magic_lifestyle_perks >= wc_perks_needed_for_level_2_magic_trait_value
					OR = {
						has_trait = user_of_$MAGIC$_magic_1
						has_trait = user_of_$MAGIC$_spirit_magic_1
						has_trait = user_of_$MAGIC$_decay_magic_1
					}
				}

				switch = {
					trigger = has_trait

					user_of_$MAGIC$_magic_1 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_magic rank = 1 } }
					user_of_$MAGIC$_spirit_magic_1 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_spirit_magic rank = 1 } }
					user_of_$MAGIC$_decay_magic_1 = { change_trait_rank = { trait = wc_lifestyle_$MAGIC$_decay_magic rank = 1 } }
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_trait = user_of_$MAGIC$_magic_1
						has_trait = user_of_$MAGIC$_spirit_magic_1
						has_trait = user_of_$MAGIC$_decay_magic_1
					}
				}

				if = { # If character doesn't have variable yet
					limit = { NOT = { has_variable = wc_$MAGIC$_favour_variable } }

					set_variable = { name = wc_$MAGIC$_favour_variable value = wc_starting_$MAGIC$_favour_value }
				}

				if = {
					limit = { wc_ELEMENT_favour_TENSE_disposition_is_spirit_trigger = { ELEMENT = $MAGIC$ TENSE = current } }

					add_trait = user_of_$MAGIC$_spirit_magic_1
				}
				else_if = {
					limit = { wc_ELEMENT_favour_TENSE_disposition_is_decay_trigger = { ELEMENT = $MAGIC$ TENSE = current } }

					add_trait = user_of_$MAGIC$_decay_magic_1
				}
				else = {
					add_trait = user_of_$MAGIC$_magic_1
				}
			}
		}
	}
	# Mana maintenance
	wc_start_mana_regeneration_loop_effect = yes # It can be character's first perk
	wc_fill_mana_on_day_one_from_perks_crutch_effect = yes
	# On action maintenance
	trigger_event = { on_action = on_perk_gained }
}

wc_ELEMENT_favour_lifestyle_check_effect = {
	if = {
		limit = {
			NOT = { has_trait = wc_lifestyle_$ELEMENT$_spirit_magic }
			wc_ELEMENT_favour_TENSE_disposition_is_spirit_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
		}

		switch = {
			trigger = has_trait

			user_of_$ELEMENT$_magic_1 = { remove_trait = user_of_$ELEMENT$_magic_1 add_trait = user_of_$ELEMENT$_spirit_magic_1 }
			user_of_$ELEMENT$_magic_2 = { remove_trait = user_of_$ELEMENT$_magic_2 add_trait = user_of_$ELEMENT$_spirit_magic_2 }
			user_of_$ELEMENT$_magic_3 = { remove_trait = user_of_$ELEMENT$_magic_3 add_trait = user_of_$ELEMENT$_spirit_magic_3 }
			user_of_$ELEMENT$_magic_4 = { remove_trait = user_of_$ELEMENT$_magic_4 add_trait = user_of_$ELEMENT$_spirit_magic_4 }
			user_of_$ELEMENT$_magic_5 = { remove_trait = user_of_$ELEMENT$_magic_5 add_trait = user_of_$ELEMENT$_spirit_magic_5 }
			user_of_$ELEMENT$_decay_magic_1 = { remove_trait = user_of_$ELEMENT$_decay_magic_1 add_trait = user_of_$ELEMENT$_spirit_magic_1 }
			user_of_$ELEMENT$_decay_magic_2 = { remove_trait = user_of_$ELEMENT$_decay_magic_2 add_trait = user_of_$ELEMENT$_spirit_magic_2 }
			user_of_$ELEMENT$_decay_magic_3 = { remove_trait = user_of_$ELEMENT$_decay_magic_3 add_trait = user_of_$ELEMENT$_spirit_magic_3 }
			user_of_$ELEMENT$_decay_magic_4 = { remove_trait = user_of_$ELEMENT$_decay_magic_4 add_trait = user_of_$ELEMENT$_spirit_magic_4 }
			user_of_$ELEMENT$_decay_magic_5 = { remove_trait = user_of_$ELEMENT$_decay_magic_5 add_trait = user_of_$ELEMENT$_spirit_magic_5 }
		}
	}
	else_if = {
		limit = {
			NOT = { has_trait = wc_lifestyle_$ELEMENT$_decay_magic }
			wc_ELEMENT_favour_TENSE_disposition_is_decay_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
		}

		switch = {
			trigger = has_trait

			user_of_$ELEMENT$_magic_1 = { remove_trait = user_of_$ELEMENT$_magic_1 add_trait = user_of_$ELEMENT$_decay_magic_1 }
			user_of_$ELEMENT$_magic_2 = { remove_trait = user_of_$ELEMENT$_magic_2 add_trait = user_of_$ELEMENT$_decay_magic_2 }
			user_of_$ELEMENT$_magic_3 = { remove_trait = user_of_$ELEMENT$_magic_3 add_trait = user_of_$ELEMENT$_decay_magic_3 }
			user_of_$ELEMENT$_magic_4 = { remove_trait = user_of_$ELEMENT$_magic_4 add_trait = user_of_$ELEMENT$_decay_magic_4 }
			user_of_$ELEMENT$_magic_5 = { remove_trait = user_of_$ELEMENT$_magic_5 add_trait = user_of_$ELEMENT$_decay_magic_5 }
			user_of_$ELEMENT$_spirit_magic_1 = { remove_trait = user_of_$ELEMENT$_spirit_magic_1 add_trait = user_of_$ELEMENT$_decay_magic_1 }
			user_of_$ELEMENT$_spirit_magic_2 = { remove_trait = user_of_$ELEMENT$_spirit_magic_2 add_trait = user_of_$ELEMENT$_decay_magic_2 }
			user_of_$ELEMENT$_spirit_magic_3 = { remove_trait = user_of_$ELEMENT$_spirit_magic_3 add_trait = user_of_$ELEMENT$_decay_magic_3 }
			user_of_$ELEMENT$_spirit_magic_4 = { remove_trait = user_of_$ELEMENT$_spirit_magic_4 add_trait = user_of_$ELEMENT$_decay_magic_4 }
			user_of_$ELEMENT$_spirit_magic_5 = { remove_trait = user_of_$ELEMENT$_spirit_magic_5 add_trait = user_of_$ELEMENT$_decay_magic_5 }
		}
	}
	else_if = {
		limit = {
			NOT = { has_trait = wc_lifestyle_$ELEMENT$_magic }
			wc_ELEMENT_favour_TENSE_disposition_is_neutral_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
		}

		switch = {
			trigger = has_trait

			user_of_$ELEMENT$_spirit_magic_1 = { remove_trait = user_of_$ELEMENT$_spirit_magic_1 add_trait = user_of_$ELEMENT$_magic_1 }
			user_of_$ELEMENT$_spirit_magic_2 = { remove_trait = user_of_$ELEMENT$_spirit_magic_2 add_trait = user_of_$ELEMENT$_magic_2 }
			user_of_$ELEMENT$_spirit_magic_3 = { remove_trait = user_of_$ELEMENT$_spirit_magic_3 add_trait = user_of_$ELEMENT$_magic_3 }
			user_of_$ELEMENT$_spirit_magic_4 = { remove_trait = user_of_$ELEMENT$_spirit_magic_4 add_trait = user_of_$ELEMENT$_magic_4 }
			user_of_$ELEMENT$_spirit_magic_5 = { remove_trait = user_of_$ELEMENT$_spirit_magic_5 add_trait = user_of_$ELEMENT$_magic_5 }
			user_of_$ELEMENT$_decay_magic_1 = { remove_trait = user_of_$ELEMENT$_decay_magic_1 add_trait = user_of_$ELEMENT$_magic_1 }
			user_of_$ELEMENT$_decay_magic_2 = { remove_trait = user_of_$ELEMENT$_decay_magic_2 add_trait = user_of_$ELEMENT$_magic_2 }
			user_of_$ELEMENT$_decay_magic_3 = { remove_trait = user_of_$ELEMENT$_decay_magic_3 add_trait = user_of_$ELEMENT$_magic_3 }
			user_of_$ELEMENT$_decay_magic_4 = { remove_trait = user_of_$ELEMENT$_decay_magic_4 add_trait = user_of_$ELEMENT$_magic_4 }
			user_of_$ELEMENT$_decay_magic_5 = { remove_trait = user_of_$ELEMENT$_decay_magic_5 add_trait = user_of_$ELEMENT$_magic_5 }
		}
	}
}

wc_change_AMOUNT_ELEMENT_favour_effect = {
	custom_description = { # Tooltip for changing elemental favour
		text = wc_change_amount_$ELEMENT$_favour_effect
		value = $AMOUNT$
	}

	if = { # Gives piety depending on doctrines
		limit = { faith = { has_doctrine_parameter = $ELEMENT$_spirit_magic_approved } }
		add_piety = {
			value = $AMOUNT$
			multiply = wc_piety_per_elemental_favour
		}
	}
	else_if = {
		limit = { faith = { has_doctrine_parameter = $ELEMENT$_decay_magic_approved } }
		add_piety = {
			value = $AMOUNT$
			multiply = -1
			multiply = wc_piety_per_elemental_favour
		}
	}

	save_temporary_scope_value_as = {
		name = wc_elemental_favour_after_change_variable
		value = $AMOUNT$
	}

	if = { # Disposition change tooltip
		limit = {
			wc_ELEMENT_favour_TENSE_disposition_is_spirit_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
			NOT = { wc_ELEMENT_favour_TENSE_disposition_is_spirit_trigger = { ELEMENT = $ELEMENT$ TENSE = current } }
		}
		custom_description = { text = wc_change_$ELEMENT$_disposition_to_spirit_effect }
	}
	else_if = {
		limit = {
			wc_ELEMENT_favour_TENSE_disposition_is_decay_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
			NOT = { wc_ELEMENT_favour_TENSE_disposition_is_decay_trigger = { ELEMENT = $ELEMENT$ TENSE = current } }
		}
		custom_description = { text = wc_change_$ELEMENT$_disposition_to_decay_effect }
	}
	else_if = {
		limit = {
			wc_ELEMENT_favour_TENSE_disposition_is_neutral_trigger = { ELEMENT = $ELEMENT$ TENSE = after_change }
			NOT = {
				wc_ELEMENT_favour_TENSE_disposition_is_neutral_trigger = { ELEMENT = $ELEMENT$ TENSE = current }
			}
		}
		custom_description = { text = wc_change_$ELEMENT$_disposition_to_neutral_effect }
	}

	wc_ELEMENT_favour_lifestyle_check_effect = { ELEMENT = $ELEMENT$ } # Trait check

	if = { # Actually changes elemental favour - need to be after wc_ELEMENT_favour_lifestyle_check_effect because otherwise wc_$ELEMENT$_favour_after_change_value will count $AMOUNT$ twice
		limit = { has_variable = wc_$ELEMENT$_favour_variable }

		change_variable = { name = wc_$ELEMENT$_favour_variable add = $AMOUNT$ }
	}
	else = {
		set_variable = { name = wc_$ELEMENT$_favour_variable value = wc_starting_$ELEMENT$_favour_value }

		change_variable = { name = wc_$ELEMENT$_favour_variable add = $AMOUNT$ }
	}
	clamp_variable = { name = wc_$ELEMENT$_favour_variable max = wc_max_elemental_favour_value min = wc_min_elemental_favour_value }
}

add_perk_xp_to_metaclass_trait = { 
	if = { 
		limit = { has_trait = ruler_metaclass_trait }
		add_xp_to_highest_metaclass_track = { GROUPNAME = ruler }
	} 
	else = { 
		add_trait = ruler_metaclass_trait
		add_xp_to_highest_metaclass_track = { GROUPNAME = ruler }
	}
}

add_xp_to_highest_metaclass_track = { 
	if = { 
		limit = { 
			has_trait_xp = {
				trait = $GROUPNAME$_metaclass_trait
				track = common
				value < 90
			}
		}
		add_trait_xp = { 
			trait = $GROUPNAME$_metaclass_trait
			track = common
			value = 10
		}
	} 
	else_if = { 
		limit = { 
			has_trait_xp = {
				trait = $GROUPNAME$_metaclass_trait
				track = uncommon
				value < 90
			}
		}
		add_trait_xp = { 
			trait = $GROUPNAME$_metaclass_trait
			track = uncommon
			value = 10
		}
	} 
	else_if = { 
		limit = { 
			has_trait_xp = {
				trait = $GROUPNAME$_metaclass_trait
				track = rare
				value < 90
			}
		}
		add_trait_xp = { 
			trait = $GROUPNAME$_metaclass_trait
			track = rare
			value = 10
		}
	} 
	else_if = { 
		limit = { 
			has_trait_xp = {
				trait = $GROUPNAME$_metaclass_trait
				track = epic
				value < 90
			}
		}
		add_trait_xp = { 
			trait = $GROUPNAME$_metaclass_trait
			track = epic
			value = 10
		}
	} 
	else_if = { 
		limit = { 
			has_trait_xp = {
				trait = $GROUPNAME$_metaclass_trait
				track = legendary
				value < 90
			}
		}
		add_trait_xp = { 
			trait = $GROUPNAME$_metaclass_trait
			track = legendary
			value = 10
		}
	}
}
