add_magic_infusion_effect = {
	save_scope_value_as = {
		name = magic_type
		value = flag:$MAGIC$
	}
	if = {
		limit = {
			scope:magic_type = flag:light_void
			$ADD$ > 0
		}
		custom_description = {
			text = "light_infusion_desc"
			value = $ADD$
		} 
	}
	else_if = {
		limit = {
			scope:magic_type = flag:light_void
			$ADD$ < 0
		}
		custom_description = {
			text = "shadow_infusion_desc"
			value = $ADD$
		} 
	}
	else_if = {
		limit = {
			scope:magic_type = flag:arcane_fel
			$ADD$ > 0
		}
		custom_description = {
			text = "arcane_infusion_desc"
			value = $ADD$
		}
	}
	else_if = {
		limit = {
			scope:magic_type = flag:arcane_fel
			$ADD$ < 0
		}
		custom_description = {
			text = "fel_infusion_desc"
			value = $ADD$
		}
	}
	else_if = {
		limit = {
			scope:magic_type = flag:nature_death
			$ADD$ > 0
		}
		custom_description = {
			text = "nature_infusion_desc"
			value = $ADD$
		}
	}
	else_if = {
		limit = {
			scope:magic_type = flag:nature_death
			$ADD$ < 0
		}
		custom_description = {
			text = "death_infusion_desc"
			value = $ADD$
		}
	}

	if = {
		limit = {
			NOT = {
				has_variable = $MAGIC$_infusion
			}
		}
		set_variable = {
			name = $MAGIC$_infusion
			value = 0
		}
	}
	change_variable = {
		name = $MAGIC$_infusion
		add = $ADD$
	}
	
	infusion_traits_effect = { MAGIC = $MAGIC$ }

	clamp_variable = { name = $MAGIC$_infusion max = 300 min = -300 }
}

infusion_traits_effect = {
	if = {
		limit = {
			has_infusion_level_trigger =  { MAGIC = $MAGIC$ AMOUNT = 3 }
		}
		if = {
			limit = {
				scope:magic_type = flag:light_void
			}
			trigger_event = WCINF.0001
		}
		else_if = {
			limit = {
				scope:magic_type = flag:arcane_fel
			}
			trigger_event = WCINF.0003
		}
		else_if = {
			limit = {
				scope:magic_type = flag:nature_death
			}
			trigger_event = WCINF.0005
		}
	}
	else_if = {
		limit = {
			has_infusion_level_trigger =  { MAGIC = $MAGIC$ AMOUNT = -3 }
		}
		if = {
			limit = {
				scope:magic_type = flag:light_void
			}
			trigger_event = WCINF.0002
		}
		else_if = {
			limit = {
				scope:magic_type = flag:arcane_fel
			}
			trigger_event = WCINF.0004
		}
		else_if = {
			limit = {
				scope:magic_type = flag:nature_death
			}
			trigger_event = WCINF.0006
		}
	}
	
	if = {
		limit = {
			$MAGIC$_infusion_level_value < 2
		}
		if = {
			limit = {
				scope:magic_type = flag:light_void
				has_trait = being_light
			}
			trigger_event = WCINF.5001
		}
		else_if = {
			limit = {
				scope:magic_type = flag:arcane_fel
				has_trait = being_order
			}
			trigger_event = WCINF.5003
		}
		else_if = {
			limit = {
				scope:magic_type = flag:nature_death
				has_trait = being_life
			}
			trigger_event = WCINF.5005
		}
	}
	
	if = {
		limit = {
			$MAGIC$_infusion_level_value > -2
		}
		if = {
			limit = {
				scope:magic_type = flag:light_void
				has_trait = being_void
			}
			trigger_event = WCINF.5002
		}
		else_if = {
			limit = {
				scope:magic_type = flag:arcane_fel
				has_trait = being_demon
			}
			trigger_event = WCINF.5004
		}
		else_if = {
			limit = {
				scope:magic_type = flag:nature_death
				has_trait = being_undead
			}
			trigger_event = WCINF.5006
		}
	}
}

infusion_trait_duel_effect = {
	duel = {
		skill = $SKILL$
		value = 13
		
		10 = {
			desc = WCINF.$EVENT$.challenge.success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 6
			}
			
			#trigger_event = WCINF.1001
			
			if = {
				limit = {
					has_variable = $MAGIC$_infusion
					var:$MAGIC$_infusion > 0
				}
				add_magic_infusion_effect = { MAGIC = $MAGIC$ ADD = -50 }
			}
			else_if = {
				limit = {
					has_variable = $MAGIC$_infusion
					var:$MAGIC$_infusion < 0
				}
				add_magic_infusion_effect = { MAGIC = $MAGIC$ ADD = 50 }
			}
		}
		
		15 = {
			desc = WCINF.$EVENT$.challenge.bad_success
			compare_modifier = {
				value = scope:duel_value
				multiplier = 3
			}
			
			#trigger_event = WCINF.1001
			add_trait = lunatic_1
			
			stress_impact = {
				base = miniscule_stress_impact_gain
			}
			
			if = {
				limit = {
					has_variable = $MAGIC$_infusion
					var:$MAGIC$_infusion > 0
				}
				add_magic_infusion_effect = { MAGIC = $MAGIC$ ADD = -25 }
			}
			else_if = {
				limit = {
					has_variable = $MAGIC$_infusion
					var:$MAGIC$_infusion < 0
				}
				add_magic_infusion_effect = { MAGIC = $MAGIC$ ADD = 25 }
			}
		}
		
		25 = {
			desc = WCINF.$EVENT$.challenge.fail
			compare_modifier = {
				value = scope:duel_value
				multiplier = -3
			}
			
			#trigger_event = WCINF.2001
			add_trait = $TRAIT$
			
			stress_impact = {
				base = minor_stress_impact_gain
			}
		}
		
		30 = {
			desc = WCINF.$EVENT$.challenge.bad_fail
			compare_modifier = {
				value = scope:duel_value
				multiplier = -6
			}
			
			#trigger_event = WCINF.2001
			add_trait = $TRAIT$
			add_trait = lunatic_1
			
			stress_impact = {
				base = medium_stress_impact_gain
			}
		}
	}
}