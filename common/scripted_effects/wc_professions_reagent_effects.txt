# Character Scope
# Calculates chance of finding reagent, then you can recall it in var:chance_current_reagent
# REAGENT = reagent flag e.g. flag:iron or something
# PROFESSION = profession e.g. mining or somehting
chance_of_finding_reagent_effect = {
	set_variable = {
		name = chance_current_reagent
		value = 15
	}
	location = {
		save_scope_as = origin
	}
	change_variable = {
		name = chance_current_reagent
		add = {
			# By Reagent Location
			switch = {
				trigger = $REAGENT$
				#BLACKSMITHING
				#Found Everywhere
				flag:gold = { 
					value = 50
				}
				flag:silver = { 
					value = 50
				}
				flag:iron = { 
					value = 50
				}
				flag:titanium = { 
					value = 50
				}
				flag:thorium = {
					if = { limit = {
						OR = {
							scope:origin.geographical_region = world_eastern_kingdoms_azeroth_stranglethorn
							scope:origin.geographical_region = world_kalimdor_south_silithus
							scope:origin.geographical_region = world_kalimdor_south_ungoro
						} }
						value = 50
					}
				}
				flag:obsidium = {
					if = { limit = {
						OR = {
							scope:origin.geographical_region = world_south_seas_vashjir
							scope:origin.geographical_region = world_kalimdor_north_hyjal
						} }
						value = 50
					}
				}
				flag:pyrite = {
					if = { limit = {
						OR = {
							scope:origin.geographical_region = world_kalimdor_south_uldum	
							scope:origin.geographical_region = world_eastern_kingdoms_lordaeron_kul_tiras
						} }
						value = 50
					}
				}
				flag:elementium = {
					if = { limit = {
						OR = {
							scope:origin.geographical_region = world_broken_isles_highmountain
							scope:origin.geographical_region = world_eastern_kingdoms_khaz_modan
							scope:origin.geographical_region = world_kalimdor_south_uldum	
							scope:origin.geographical_region = world_kalimdor_south_tanaris
						} }
						value = 50
					}
				}
				flag:trillium = {
					if = { limit = { scope:origin.geographical_region = world_pandaria } 
						value = 50
					}
				} 
				flag:saronite = {
					if = { limit = { scope:origin.geographical_region = world_northrend }
						value = 50
					}
				}
				flag:titansteel = {
					if = { limit = { scope:origin.geographical_region = world_northrend }
						value = 50
					}
				}
				flag:ghost_iron = {
					if = { limit = { scope:origin.geographical_region = world_pandaria } 
						value = 50
					}
				}
				flag:draconium = {
					if = { limit = {
						OR = {
							this = b_dragon_isles
							this = b_mostrasz
							scope:origin.province.owner ?= { has_trait_with_flag = dragon_family }
						} }
						value = 50
					}
				}
				flag:leystone = {
					if = { limit = { scope:origin.geographical_region = world_broken_isles }
						value = 50
					}
				}
				flag:felsteel = {
					if = { limit = { 
						OR = {
							scope:origin.geographical_region = world_broken_isles
							scope:origin.province.owner ?= { has_trait_with_flag = demon_class }
						} }
						value = 50
					}
				}
				flag:cobalt = {
					if = { limit = { scope:origin.geographical_region = world_northrend }
						value = 50
					}
				}
				flag:khorium = {
					if = { limit = { scope:origin.geographical_region = world_eastern_kingdoms_quelthalas }
						value = 50
					}
				}
				flag:earthen = {
					if = { limit = { 
						OR = {
							scope:origin.geographical_region = world_northrend
							scope:origin.geographical_region = world_eastern_kingdoms_khaz_modan
						} }
						value = 50
					}
				}
				flag:mithril = {
					if = { limit = { 
						OR = {
							scope:origin.geographical_region = world_eastern_kingdoms 
							scope:origin.geographical_region = world_kalimdor
						}}
						value = 50
					}
				}
				flag:kyparite ={
					if = { limit = { scope:origin.geographical_region = world_pandaria } 
						value = 50
					}
				}
				flag:mojo_stone = {
					if = {
						OR = {
							scope:origin.province.owner ?= { has_trait = creature_troll }
							scope:origin.geographical_region = world_south_seas_zandalar
						} 
					}
				}
			}
			# By Rarity
			if = {
				limit = { reagent_rarity_is_very_common_trigger = { REAGENT = $REAGENT$ } }
				value = 20
			}
			if = {
				limit = { reagent_rarity_is_common_trigger = { REAGENT = $REAGENT$ } }
				value = 15
			}
			if = {
				limit = { reagent_rarity_is_uncommon_trigger = { REAGENT = $REAGENT$ } }
				value = 10
			}
			if = {
				limit = { reagent_rarity_is_rare_trigger = { REAGENT = $REAGENT$ } }
				value = 5
			}
			if = {
				limit = { reagent_rarity_is_exotic_trigger = { REAGENT = $REAGENT$ } }
				value = -5
			}
			if = {
				limit = { reagent_is_gem_trigger = { REAGENT = $REAGENT$ } }
				if = { # Small bonus for jewelcrafters
					limit = { has_trait = profession_jewelcrafter }
					value = 10
				}
				value = -5
			}
			# By Skill
			if = {
				limit = { has_character_flag = $PROFESSION$_foraging_excellent }
				value = 10
			}
			if = {
				limit = { has_character_flag = $PROFESSION$_foraging_good }
				value = 5
			}
			if = {
				limit = { has_character_flag = $PROFESSION$_foraging_novice }
				value = -5
			}
			# some rng
			value = { -20 20 }
		}
	}
}
		
add_starter_reagents_effect = {
	if = {
		#incase they switched back
		limit = { $PROFESSION$ = flag:mining }
		if = {  limit = { NOT = { exists = var:mining_known_reagents_count } }
			set_variable = {
				name = profession_mining_known_reagents_count
				value = 0
			}
		}
		if = {  limit = { NOT = { exists = var:mining_items_made } }
			set_variable = {
				name = mining_items_made
				value = 0
			}
		}
		if = {  limit = { NOT = { has_variable_list = mining_known_reagents } }
			discover_reagent_effect = { PROFESSION = mining REAGENT = flag:gold }
			discover_reagent_effect = { PROFESSION = mining REAGENT = flag:silver }
			discover_reagent_effect = { PROFESSION = mining REAGENT = flag:iron }
		}
				
	}
}
# REAGENTS AND INVENTORY
# ALL CHARACTER SCOPE
discover_reagent_effect = {
	set_variable = {
		name = current_reagent
		value = $REAGENT$
	}
	send_interface_message = {
		title = discovered_reagent_title
		desc = discovered_reagent_desc
		left_icon = root
		add_to_variable_list = {
			name = $PROFESSION$_known_reagents
			target = $REAGENT$
		}
		add_trait_xp = {
			trait = profession_$PROFESSION$
			track = profession_$PROFESSION$
			value = 1
		}
		change_variable = {
			name = profession_$PROFESSION$_known_reagents_count
			add = 1
		}
	}
	remove_variable = current_reagent
}

init_reagents_effect = {
	init_mining_reagents_effect = yes
}

init_mining_reagents_effect = {
	# Blacksmithing + Mining Reagents
	add_to_global_variable_list = { name = mining_reagents target = flag:thorium }
	add_to_global_variable_list = { name = mining_reagents target = flag:obsidium }
	add_to_global_variable_list = { name = mining_reagents target = flag:gold }
	add_to_global_variable_list = { name = mining_reagents target = flag:pyrite }
	add_to_global_variable_list = { name = mining_reagents target = flag:elementium }
	add_to_global_variable_list = { name = mining_reagents target = flag:iron }
	add_to_global_variable_list = { name = mining_reagents target = flag:silver }
	add_to_global_variable_list = { name = mining_reagents target = flag:saronite }
	add_to_global_variable_list = { name = mining_reagents target = flag:titansteel }
	add_to_global_variable_list = { name = mining_reagents target = flag:ghost_iron }
	add_to_global_variable_list = { name = mining_reagents target = flag:draconium }
	add_to_global_variable_list = { name = mining_reagents target = flag:leystone }
	add_to_global_variable_list = { name = mining_reagents target = flag:cobalt }
	add_to_global_variable_list = { name = mining_reagents target = flag:khorium }
	add_to_global_variable_list = { name = mining_reagents target = flag:felsteel }
	add_to_global_variable_list = { name = mining_reagents target = flag:earthen }
	add_to_global_variable_list = { name = mining_reagents target = flag:mithril }
	add_to_global_variable_list = { name = mining_reagents target = flag:kyparite }
	add_to_global_variable_list = { name = mining_reagents target = flag:titanium }
	add_to_global_variable_list = { name = mining_reagents target = flag:nethercite }
	add_to_global_variable_list = { name = mining_reagents target = flag:emerald }
	add_to_global_variable_list = { name = mining_reagents target = flag:opal }
	add_to_global_variable_list = { name = mining_reagents target = flag:diamond }
	add_to_global_variable_list = { name = mining_reagents target = flag:amethyst }
	add_to_global_variable_list = { name = mining_reagents target = flag:malygite }
	add_to_global_variable_list = { name = mining_reagents target = flag:night_stone }
	add_to_global_variable_list = { name = mining_reagents target = flag:mojo_stone }
	add_to_global_variable_list = { name = mining_reagents target = flag:mana_stone }
	add_to_global_variable_list = { name = mining_reagents target = flag:ruby }
	add_to_global_variable_list = { name = mining_reagents target = flag:lapis_lazuli }

	add_to_global_variable_list = { name = mining_reagents_types target = flag:ore }
	add_to_global_variable_list = { name = mining_reagents_types target = flag:bar }
}