gorak_tul_create_court_effect = { # Gorak Tul Realm, Court and Army Setup
	# Summon a mighty host!
	#gorak_tul_spawn_starting_troops_effect = yes
	
	hidden_effect = {
		if = {
			limit = {
				is_ai = yes
				current_year >= 650
			}
			#gorak_tul_spawn_more_troops_ai_effect = yes
		}
	
		### Summon Gorak Tul's most trusted courtiers
		# Gorak Zhar
		create_character = {
			template = gorak_zhar_character_template
			save_scope_as = gorak_zhar
			employer = root
		}
		marry = scope:gorak_tul
		add_hook = {
			target = scope:gorak_zhar
			type = loyalty_hook
		}
		
		# Ingra Maloch
		create_character = {
			template = ingra_maloch_character_template
			save_scope_as = ingra_maloch
			employer = root
		}
		add_hook = {
			target = scope:ingra_maloch
			type = loyalty_hook
		}
		
		# Ingra Drif
		create_character = {
			template = ingra_drif_character_template
			save_scope_as = ingra_drif
			employer = root
		}
		add_hook = {
			target = scope:ingra_drif
			type = loyalty_hook
		}
		
		# Ingra Saor
		create_character = {
			template = ingra_saor_character_template
			save_scope_as = ingra_saor
			employer = root
		}
		add_hook = {
			target = scope:ingra_saor
			type = loyalty_hook
		}
	}
}

gorak_tul_effect = { # Title management for Gorak Tul
	ROOT = { save_scope_as = summoner }
	set_variable = {
		name = summoner
		value = scope:summoner
	}
	
	# Set up Titles
	create_title_and_vassal_change = {
		type = returned
		save_scope_as = change
		#add_claim_on_loss = no
	}
	title:k_drustvar = {
		holder = {
			if = {
				limit = { NOT = { this = scope:reviver } }
				add_opinion = {
					target = scope:lei_shen
					modifier = revoked_title
					opinion = -30
				}
			}
		}
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	title:c_fates_end = {
		holder = {
			if = {
				limit = { NOT = { this = scope:reviver } }
				add_opinion = {
					target = scope:lei_shen
					modifier = revoked_title
					opinion = -30
				}
			}
		}
		change_title_holder = {
			holder = scope:lei_shen
			change = scope:change
		}
	}
	
	scope:summoner = {
		every_held_title = {
			if = {
				limit = {
					tier = tier_kingdom
				}
				change_title_holder = {
					holder = scope:gorak_tul
					change = scope:change
				}
			}
			else_if = {
				limit = {
					OR = {
						NOT = { exists = scope:secondary_title }
						tier > scope:secondary_title.tier
					}
				}
				save_temporary_scope_as = secondary_title
			}
		}
	}
	
	scope:summoner = {
		if = {
			limit = {
				exists = scope:secondary_title
			}
			every_vassal = {
				limit = {
					primary_title.tier >= scope:secondary_title.tier
					NOT = {
						primary_title.tier = tier_barony
					}
				}
				change_liege = {
					liege = scope:gorak_tul
					change = scope:change
				}
			}
		}
	}
	
	scope:summoner = {
		change_liege = {
			liege = scope:gorak_tul
			change = scope:change
		}
	}
	
	resolve_title_and_vassal_change = scope:change
	
	if = {
		limit = {
			has_title = title:k_drustvar
		}
		set_primary_title_to = title:k_drustvar
		title:k_drustvar = {
			set_capital_county = title:c_fates_end
		}
	}
	
	scope:summoner = {
		#Add Alliance
		custom_tooltip = gorak_tul_negotiate_alliance_effect_tooltip
		hidden_effect = {
			create_alliance = {
				target = scope:gorak_tul
				allied_through_owner = this
				allied_through_target = scope:gorak_tul
			}
		}
		add_truce_both_ways = {
			character = scope:gorak_tul
			years = 5
			name = TRUCE_GORAK_TUL
		}
	}
	#Set max authority
	if = {
		limit = { has_realm_law_flag = uses_crown_authority }
		add_realm_law = crown_authority_3
	}
	if = {
		limit = { has_realm_law_flag = uses_tribal_authority }
		add_realm_law = tribal_authority_3
	}
	if = {
		limit = { realm_law_use_dark_frenzy_trigger = yes }
		change_dark_frenzy_effect = { VALUE = 50 }
	}
	
	#Control Counties
	every_held_county = { change_county_control = 100 }
	title:c_fates_end = {
		set_county_culture = culture:drust
		set_county_faith = faith:throsic
	}
	
	# Add hooks to loyal servant
	add_hook = {
		target = scope:summoner
		type = loyalty_hook
	}
	scope:summoner = {
		add_opinion = {
			modifier = became_vassal
			target = scope:gorak_tul
			opinion = 50
		}
		#Add Alliance
		custom_tooltip = gorak_tul_negotiate_alliance_effect_tooltip
		hidden_effect = {
			create_alliance = {
				target = scope:gorak_tul
				allied_through_owner = this
				allied_through_target = scope:gorak_tul
			}
		}
		add_truce_both_ways = {
			character = scope:gorak_tul
			years = 5
			name = TRUCE_GORAK_TUL
		}
		if = {
			limit = {
				is_landed = no
			}
			set_employer = scope:gorak_tul
		}
	}
	# Add AI Buff
	if = {
		limit = { is_ai = yes }
		add_gold = 2000
		add_dread = 100
	}
	else = {
		add_gold = 500
		add_prestige = 500
		add_dread = 50
	}
	hidden_effect = {
		if = {
			limit = { is_ai = yes }
			add_character_modifier = {
				modifier = wc_gorak_tul_ai_modifier
				years = 30
			}
		}
		debug_log = "Gorak Tul has been summoned"
	}
}